{"version":3,"file":"context-menu.js","sources":["../node_modules/style-inject/dist/style-inject.es.js","../src/context-menu.js"],"sourcesContent":["function styleInject(css, ref) {\n  if ( ref === void 0 ) ref = {};\n  var insertAt = ref.insertAt;\n\n  if (!css || typeof document === 'undefined') { return; }\n\n  var head = document.head || document.getElementsByTagName('head')[0];\n  var style = document.createElement('style');\n  style.type = 'text/css';\n\n  if (insertAt === 'top') {\n    if (head.firstChild) {\n      head.insertBefore(style, head.firstChild);\n    } else {\n      head.appendChild(style);\n    }\n  } else {\n    head.appendChild(style);\n  }\n\n  if (style.styleSheet) {\n    style.styleSheet.cssText = css;\n  } else {\n    style.appendChild(document.createTextNode(css));\n  }\n}\n\nexport default styleInject;\n","import './styles.less';\n\nconst instances = [];\nlet nextId = 0;\n\n// Tiny polyfill for Element.matches() for IE\nif (!Element.prototype.matches) {\n  Element.prototype.matches = Element.prototype.msMatchesSelector;\n}\n\n// Gets an element's next/previous sibling that matches the given selector\nfunction getSibling(el, selector, direction = 1) {\n  const sibling = direction > 0 ? el.nextElementSibling : el.previousElementSibling;\n  if (!sibling || sibling.matches(selector)) {\n    return sibling;\n  }\n  return getSibling(sibling, selector, direction);\n}\n\n// Fires custom event on given element\nfunction emit(el, type, data = {}) {\n  const event = document.createEvent('Event');\n\n  Object.keys(data).forEach((key) => {\n    event[key] = data[key];\n  });\n\n  event.initEvent(type, true, true);\n  el.dispatchEvent(event);\n}\n\nexport default class ContextMenu {\n  constructor(selector, items, options = {\n    className: '',\n    minimalStyling: false,\n  }) {\n    this.selector = selector;\n    this.items = items;\n    this.options = options;\n    this.id = nextId++;\n    this.target = null;\n\n    this.create();\n    instances.push(this);\n  }\n\n  // Creates DOM elements, sets up event listeners\n  create() {\n    // Create root <ul>\n    this.menu = document.createElement('ul');\n    this.menu.className = 'ContextMenu';\n    this.menu.setAttribute('data-contextmenu', this.id);\n    this.menu.setAttribute('tabindex', -1);\n    this.menu.addEventListener('keyup', (e) => {\n      switch (e.which) {\n        case 38:\n          this.moveFocus(-1);\n          break;\n        case 40:\n          this.moveFocus(1);\n          break;\n        case 27:\n          this.hide();\n          break;\n        default:\n          // do nothing\n      }\n    });\n\n    if (!this.options.minimalStyling) {\n      this.menu.classList.add('ContextMenu--theme-default');\n    }\n    if (this.options.className) {\n      this.options.className.split(' ').forEach(cls => this.menu.classList.add(cls));\n    }\n\n    // Create <li>'s for each menu item\n    this.items.forEach((item, index) => {\n      const li = document.createElement('li');\n\n      if (!('name' in item)) {\n        // Insert a divider\n        li.className = 'ContextMenu-divider';\n      } else {\n        li.className = 'ContextMenu-item';\n        li.textContent = item.name;\n        li.setAttribute('data-contextmenuitem', index);\n        li.setAttribute('tabindex', 0);\n        li.addEventListener('click', this.select.bind(this, li));\n        li.addEventListener('keyup', (e) => {\n          if (e.which === 13) {\n            this.select(li);\n          }\n        });\n      }\n\n      this.menu.appendChild(li);\n    });\n\n    // Add root element to the <body>\n    document.body.appendChild(this.menu);\n\n    emit(this.menu, 'created');\n  }\n\n  // Shows context menu\n  show(e) {\n    this.menu.style.left = `${e.pageX}px`;\n    this.menu.style.top = `${e.pageY}px`;\n    this.menu.classList.add('is-open');\n    this.target = e.target;\n    // Give context menu focus\n    this.menu.focus();\n    // Disable native context menu\n    e.preventDefault();\n\n    emit(this.menu, 'shown');\n  }\n\n  // Hides context menu\n  hide() {\n    this.menu.classList.remove('is-open');\n    this.target = null;\n    emit(this.menu, 'hidden');\n  }\n\n  // Selects the given item and calls its handler\n  select(item) {\n    const itemId = item.getAttribute('data-contextmenuitem');\n    if (this.items[itemId]) {\n      // Call item handler with target element as parameter\n      this.items[itemId].fn(this.target);\n    }\n    this.hide();\n    emit(this.menu, 'itemselected');\n  }\n\n  // Moves focus to the next/previous menu item\n  moveFocus(direction = 1) {\n    const focused = this.menu.querySelector('[data-contextmenuitem]:focus');\n    let next;\n\n    if (focused) {\n      next = getSibling(focused, '[data-contextmenuitem]', direction);\n    }\n\n    if (!next) {\n      next = direction > 0\n        ? this.menu.querySelector('[data-contextmenuitem]:first-child')\n        : this.menu.querySelector('[data-contextmenuitem]:last-child');\n    }\n\n    if (next) next.focus();\n  }\n\n  // Convenience method for adding an event listener\n  on(type, fn) {\n    this.menu.addEventListener(type, fn);\n  }\n\n  // Convenience method for removing an event listener\n  off(type, fn) {\n    this.menu.removeEventListener(type, fn);\n  }\n\n  // Removes DOM elements, stop listeners\n  destroy() {\n    this.menu.parentElement.removeChild(this.menu);\n    this.menu = null;\n    instances.splice(instances.indexOf(this), 1);\n  }\n}\n\n// Listen for contextmenu event to show menu\ndocument.addEventListener('contextmenu', (e) => {\n  instances.forEach((menu) => {\n    if (e.target.matches(menu.selector)) {\n      menu.show(e);\n    }\n  });\n});\n\n// Listen for click event to hide menu\ndocument.addEventListener('click', (e) => {\n  instances.forEach((menu) => {\n    if (!e.target.matches(`[data-contextmenu=\"${menu.id}\"], [data-contextmenu=\"${menu.id}\"] *`)) {\n      menu.hide();\n    }\n  });\n});\n"],"names":["css","ref","insertAt","document","head","getElementsByTagName","style","createElement","type","firstChild","insertBefore","appendChild","styleSheet","cssText","createTextNode","const","instances","nextId","emit","el","data","event","createEvent","Object","keys","forEach","key","initEvent","dispatchEvent","Element","prototype","matches","msMatchesSelector","ContextMenu","selector","items","options","className","minimalStyling","this","id","target","create","push","menu","setAttribute","addEventListener","e","which","moveFocus","hide","classList","add","split","cls","item","index","li","textContent","name","select","bind","this$1","body","show","left","top","focus","preventDefault","remove","itemId","getAttribute","fn","direction","next","focused","querySelector","getSibling","sibling","nextElementSibling","previousElementSibling","on","off","removeEventListener","destroy","parentElement","removeChild","splice","indexOf"],"mappings":"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"}